<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<pre class="pas-source"><span class="pas-kwd">library</span><span class="pas-space"> </span><span class="pas-ident">demologger</span><span class="pas-sym">;</span>
<span class="pas-comment">// Demo-Library f&#252;r IPS-Module</span>
<span class="pas-comment">// Thomas Dre&#223;ler 2009-2012</span>
<span class="pas-comment">// frei f&#252;r private Nutzung</span>

<span class="pas-kwd">uses</span>
<span class="pas-space">  </span><span class="pas-ident">simplesharemem</span><span class="pas-sym">,</span>
<span class="pas-space">  </span><span class="pas-ident">Windows</span><span class="pas-sym">,</span>
<span class="pas-space">  </span><span class="pas-ident">StrUtils</span><span class="pas-sym">,</span>
<span class="pas-space">  </span><span class="pas-ident">Classes</span><span class="pas-sym">,</span>
<span class="pas-space">  </span><span class="pas-ident">SysUtils</span><span class="pas-sym">,</span>
<span class="pas-space">  </span><span class="pas-ident">UIPSTypes</span><span class="pas-sym">,</span>
<span class="pas-space">  </span><span class="pas-ident">UIPSModuleTypes</span><span class="pas-sym">,</span>
<span class="pas-space">  </span><span class="pas-ident">UModuleInterface</span><span class="pas-space"> </span><span class="pas-kwd">in</span><span class="pas-space"> </span><span class="pas-str">'UModuleInterface.pas'</span><span class="pas-sym">,</span>
<span class="pas-space">  </span><span class="pas-ident">UDevice</span><span class="pas-space"> </span><span class="pas-kwd">in</span><span class="pas-space"> </span><span class="pas-str">'UDevice.pas'</span><span class="pas-sym">;</span>

<span class="pas-preproc">{$R *.res}</span>

<span class="pas-comment">//Standard-Texte, mussen bei jeder Library existieren</span>
<span class="pas-comment">//------------------------------------------------------------------------------</span>
<span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">IPSModuleRegister</span><span class="pas-sym">(</span><span class="pas-ident">Kernel</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">IIPSKernel</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">ModuleRegistry</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">IIPSModuleRegistry</span><span class="pas-sym">)</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">stdcall</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">forward</span><span class="pas-sym">;</span>
<span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">IPSModuleUnregister</span><span class="pas-sym">(</span><span class="pas-sym">)</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">stdcall</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">forward</span><span class="pas-sym">;</span>

<span class="pas-comment">//------------------------------------------------------------------------------</span>
<span class="pas-kwd">const</span><span class="pas-space"> </span><span class="pas-ident">LibInfo</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">TIPSLibraryInfo</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-sym">(</span>
<span class="pas-space">                                 </span><span class="pas-ident">mUniqueID</span><span class="pas-space">    </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-str">'{30dec678-a21a-41f8-840b-cfd52a4a9436}'</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-comment">//F&#252;r jedes Modul mit STRG-SHIFT-G neu erstellen !!</span>
<span class="pas-space">                                 </span><span class="pas-comment">//-------------------------- //n&#228;chste 3 Zeilen anpassen, Build muss leider Manuell hizugef&#252;gt werden</span>
<span class="pas-space">                                 </span><span class="pas-ident">mAuthor</span><span class="pas-space">      </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-str">'Thomas Dre&#223;ler'</span><span class="pas-sym">;</span>
<span class="pas-space">                                 </span><span class="pas-ident">mURL</span><span class="pas-space">         </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-str">'www.ipsymcon.de'</span><span class="pas-sym">;</span>
<span class="pas-space">                                 </span><span class="pas-ident">mName</span><span class="pas-space">        </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-str">'Demo Modul &quot;Logger&quot;'</span><span class="pas-sym">;</span>
<span class="pas-space">                                 </span><span class="pas-ident">mVersion</span><span class="pas-space">     </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-comment">{CompileVersion}</span><span class="pas-hex">$0246</span><span class="pas-comment">{/CompileVersion}</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-comment">{ Hi - MajorV, Lo - MinorV }</span>
<span class="pas-space">                                 </span><span class="pas-ident">mBuild</span><span class="pas-space">       </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-comment">{CompileBuild}</span><span class="pas-num">38</span><span class="pas-comment">{/CompileBuild}</span><span class="pas-sym">;</span>
<span class="pas-space">                                 </span><span class="pas-ident">mDate</span><span class="pas-space">        </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-comment">{CompileTime}</span><span class="pas-num">0</span><span class="pas-comment">{/CompileTime}</span><span class="pas-sym">;</span>
<span class="pas-space">                                 </span><span class="pas-comment">//-------------------------- //nicht &#228;ndern!</span>
<span class="pas-space">                                 </span><span class="pas-ident">mKernelVersion</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">KERNEL_VERSION</span><span class="pas-sym">;</span>
<span class="pas-space">                                 </span><span class="pas-comment">//--------------------------</span>
<span class="pas-space">                                 </span><span class="pas-ident">fRegister</span><span class="pas-space">    </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">IPSModuleRegister</span><span class="pas-sym">;</span>
<span class="pas-space">                                 </span><span class="pas-ident">fUnregister</span><span class="pas-space">  </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">IPSModuleUnregister</span><span class="pas-sym">;</span>
<span class="pas-space">                               </span><span class="pas-sym">)</span><span class="pas-sym">;</span>

<span class="pas-comment">//------------------------------------------------------------------------------</span>
<span class="pas-kwd">var</span><span class="pas-space"> </span><span class="pas-ident">vKernel</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">IIPSKernel</span><span class="pas-sym">;</span>

<span class="pas-comment">//------------------------------------------------------------------------------</span>
<span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">IPSLibraryInfo</span><span class="pas-sym">(</span><span class="pas-kwd">var</span><span class="pas-space"> </span><span class="pas-ident">LibraryInfo</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PIPSLibraryInfo</span><span class="pas-sym">)</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">stdcall</span><span class="pas-sym">;</span>
<span class="pas-kwd">begin</span>

<span class="pas-space"> </span><span class="pas-ident">LibraryInfo</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-sym">@</span><span class="pas-ident">LibInfo</span><span class="pas-sym">;</span>

<span class="pas-kwd">end</span><span class="pas-sym">;</span>

<span class="pas-comment">//------------------------------------------------------------------------------</span>
<span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">IPSModuleRegister</span><span class="pas-sym">(</span><span class="pas-ident">Kernel</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">IIPSKernel</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">ModuleRegistry</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">IIPSModuleRegistry</span><span class="pas-sym">)</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">stdcall</span><span class="pas-sym">;</span>
<span class="pas-comment">{Modul registerfunktion</span>
<span class="pas-comment">f&#252;r jedes Modul(Device, Splitter muss ein Eintag existieren. Die Interface und Typinfo</span>
<span class="pas-comment">sollten &#252;ber units bekannt gemacht sein</span>
<span class="pas-comment">}</span>

<span class="pas-kwd">begin</span>

<span class="pas-space"> </span><span class="pas-ident">vKernel</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-ident">Kernel</span><span class="pas-sym">;</span>
<span class="pas-space"> </span><span class="pas-ident">vKernel</span><span class="pas-sym">.</span><span class="pas-ident">LogMessage</span><span class="pas-sym">(</span><span class="pas-ident">KL_MESSAGE</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">LibInfo</span><span class="pas-sym">.</span><span class="pas-ident">mName</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-str">'Register Build '</span><span class="pas-sym">+</span><span class="pas-ident">inttostr</span><span class="pas-sym">(</span><span class="pas-ident">LibInfo</span><span class="pas-sym">.</span><span class="pas-ident">mBuild</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span>

<span class="pas-space"> </span><span class="pas-comment">//Register Classes</span>
<span class="pas-space"> </span><span class="pas-comment">{ein Eintrag pro Modul. Es k&#246;nnen auch mehrere Module in einer Library registriert werden</span>
<span class="pas-comment"> alle Module landen dann in der gleichen DLL. Type und Interface m&#252;ssen anschliessend</span>
<span class="pas-comment"> im Modul definiert werden: Type=ObjektType in UDevice, Interface in ModulInterface</span>
<span class="pas-comment"> Eine gute Praxis ist es, f&#252;r jedes Device/Splitter eine eigene Unit anzulegen,</span>
<span class="pas-comment"> so das innerhalb einer Unit nur mit einem Objekt gearbeitet werden muss</span>
<span class="pas-comment"> Die PHP-Funktionen werden den als NamensPrefix den letzter Parameter haben}</span>
<span class="pas-space"> </span><span class="pas-ident">ModuleRegistry</span><span class="pas-sym">.</span><span class="pas-ident">RegisterModule</span><span class="pas-sym">(</span><span class="pas-ident">TIPSDevice</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">TypeInfo</span><span class="pas-sym">(</span><span class="pas-ident">IIPSDevice</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-str">'MyDevice'</span><span class="pas-sym">)</span><span class="pas-sym">;</span>

<span class="pas-kwd">end</span><span class="pas-sym">;</span>

<span class="pas-comment">//------------------------------------------------------------------------------</span>
<span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">IPSModuleUnregister</span><span class="pas-sym">(</span><span class="pas-sym">)</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">stdcall</span><span class="pas-sym">;</span>
<span class="pas-kwd">begin</span>

<span class="pas-space"> </span><span class="pas-ident">vKernel</span><span class="pas-sym">.</span><span class="pas-ident">LogMessage</span><span class="pas-sym">(</span><span class="pas-ident">KL_MESSAGE</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">LibInfo</span><span class="pas-sym">.</span><span class="pas-ident">mName</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-str">'Unregister'</span><span class="pas-sym">)</span><span class="pas-sym">;</span>
<span class="pas-space"> </span><span class="pas-ident">vKernel</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-kwd">NIL</span><span class="pas-sym">;</span>

<span class="pas-kwd">end</span><span class="pas-sym">;</span>

<span class="pas-comment">//==============================================================================</span>
<span class="pas-kwd">exports</span><span class="pas-space"> </span><span class="pas-ident">IPSLibraryInfo</span><span class="pas-sym">;</span>

<span class="pas-kwd">begin</span>
<span class="pas-space"> </span><span class="pas-comment">//</span>
<span class="pas-kwd">end</span><span class="pas-sym">.</span>
</pre>
